/*
 * File: app/controller/AccountTransactions.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('FP.controller.AccountTransactions', {
    extend: 'Ext.app.Controller',

    config: {
        routes: {
            'accountBalance': 'showAccountBalance'
        },

        control: {
            "container#accountBalance": {
                show: 'onAccountBalanceShow'
            },
            "list#accountBalance": {
                deactivate: 'onAccountBalanceDeactivate',
                initialize: 'onAccountBalanceInitialize',
                activate: 'onAccountBalanceActivate',
                itemtap: 'onAccountBalanceItemTap'
            }
        }
    },

    onAccountBalanceShow: function(component, eOpts) {
        var store = Ext.getStore('accountBalance'),
            records = store.data.items,
            balanceDisplay = Ext.ComponentQuery.query('#balanceDisplay')[0],
            total = FP.app.calculateBalance(),
            display = Math.abs(total).toFixed(2);

        balanceDisplay.setHtml(this.displayBalance(total, display));


    },

    onAccountBalanceDeactivate: function(oldActiveItem, container, newActiveItem, eOpts) {
        var main = Ext.getCmp('main');

        main.query('#accountInfo')[0].hide();
    },

    onAccountBalanceInitialize: function(component, eOpts) {
        var main = Ext.getCmp('main'),
            accountMenu = main.query('#accountMenu')[0],
            store = component.getStore();

        //accountMenu.hide();

        component.setScrollable({ directionLock: true, scroll: 'vertical' });

        // List spacer for bottom toolbar.
        component.add({xtype:'component', height:40, scrollDock: 'bottom'});

        store.clearFilter();
        store.filter('userAccount_id', FP.config.Runtime.getUserAccount().id, false, true);
    },

    onAccountBalanceActivate: function(newActiveItem, container, oldActiveItem, eOpts) {
        Ext.ComponentQuery.query('#accountInfo')[0].show();
    },

    onAccountBalanceItemTap: function(dataview, index, target, record, e, eOpts) {
        var runtime = FP.config.Runtime;

        runtime.setTransaction(record.data);
        console.log(runtime.getTransaction());
        this.redirectTo('accountBalanceForm/edit');
    },

    showAccountBalance: function() {
        var main = Ext.getCmp('main'),
            accountBalance = Ext.create('FP.view.AccountBalance'),
            back = main.query('#back')[0],
            runtime = FP.config.Runtime,
            toolbar = main.query('#toolbar')[0],
            record = runtime.getUserAccount(),
            accountName = main.query('#accountName')[0];



        Ext.ComponentQuery.query('#editUser')[0].setText('Edit');
        back.show();

        back.view = '#accountBalance';

        toolbar.setTitle(record.name);

        main.query('#accountMenu')[0].show();

        accountName.setHtml('<b>'+record.name+'</b>');
        main.setActiveItem(accountBalance);
    },

    displayBalance: function(total, display) {
        if(total < 0) {
            return '<span  style="font-size: 1.4em;" class="negative">($'+display+')</span>';
        } else if(total > 0) {
            return '<span  style="font-size: 1.4em;" class="positive">$'+display+'</span>';
        } else if(total === 0) {
            return '<span style="font-size: 1.4em;" class="balanceDisplay zero">$'+display+'</span>';
        }
    }

});